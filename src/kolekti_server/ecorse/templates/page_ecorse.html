<!DOCTYPE html>
<html lang="fr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>EcoRSE {% block page-title %}{% endblock %}</title>
		<link rel="icon" href="/static/kolekti.png">
		
		<!-- Bootstrap -->
		{% if DEBUG %} {# paramètre DEBUG dans /media/donnees/web/ecorse/kolekti/src/kolekti_server/kolekti_server/settings.py #}
			{% with use_bsless=False %}
				<!-- Bootstrap -->
				{% if use_bsless %}				
					<link rel="stylesheet/less" type="text/css" href="/static/bootstrap/less/bootstrap.less"/>
				{% else %}
					<link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
				{% endif %}			
				<!-- <div>{{ use_bsless }}</div> -->
			{% endwith %}
			<!-- Custom styles for this template -->
			<link rel="stylesheet/less" type="text/css" href="/static/less/ecorse.less"/>
			<script type="text/javascript">
			  less = {
			  env: "development",
			  dumpLineNumbers: "mediaquery"
			  //dumpLineNumbers: "comments"
			  };
			</script>
			<script type="text/javascript" src="/static/js/less.min.js"></script>
		{% else %}
			<link href="/static/bootstrap/css/bootstrap.min.css" rel="stylesheet">
			<link href="/static/css/ecorse.css" rel="stylesheet">			
		{% endif %}
			<link href="/static/css/ecorse-topics.css" rel="stylesheet">
		<!-- Font Awesome -->
		<link href="/static/font-awesome/css/font-awesome.min.css" rel="stylesheet">

		{% block extracss %}{% endblock %}
		
		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
			<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
			<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->

	</head>

	<body role="document">
		<!-- Fixed navbar -->
		<nav class="navbar navbar-ecorse navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
					{% comment %} <button type="button" class="navbar-toggle collapsed btn btn-default navbar-btn" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar" title="Afficher/Cacher le menu">
						<span class="sr-only">Toggle navigation</span>
						<i class="fa fa-reorder"></i>
					</button> {% endcomment %}
					<button class="navbar-toggle collapsed btn btn-default navbar-btn" type="button" id="hide-menu"  data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
								<a href="javascript:void(0);" data-action="toggleMenu" title="Afficher/Cacher le menu"><i class="fa fa-reorder"></i></a>
							</button>
					<a class="navbar-brand page-scroll" href="http://www.ecorse.eu"><img height="40px" src="/static/img/logo.png" alt="logo Ecorse"></a>
				</div>
				<div id="navbar" class="navbar-collapse collapse">
					{% if release %}
					<ul class="nav navbar-nav">
					    <li class="active"><a href="/">Accueil</a></li>
					    {% if user.is_authenticated %}  
						<li class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Rapports &nbsp;<span class="caret"></span></a>
							<ul class="dropdown-menu">
								{% for release in releases %}
									<li class="{% if release.name == current %} active{% endif %}" >
										<a href="{% url 'elocusreport' %}?release=/releases/{{release.name}}">{{release.label}}</a>
									</li>
								{% endfor %}
								{% if releases %}
								<li role="separator" class="divider"></li>
								{% endif %}
								<li>
									<a href="#" class="ecorse-action-create-report" data-toggle="modal" data-target="#modal_create">Créer rapport... </a>
								</li>

							
							</ul>
						</li>
						{% endif %}
					</ul>
					{% endif %}

					<ul class="nav navbar-nav navbar-right">
					    {% comment %}
					    <li>
					    	<a href="http://www.ecorse.eu">À propos</a>
					    </li>
					    {% endcomment %}
					    {% if user.is_authenticated %}    
					    <li class="dropdown">
					        <a href="#" data-toggle="dropdown" class="dropdown-toggle active" aria-expanded="false">
                                <i class="fa fa-user fa-fw"></i> {{ user.first_name }} {{ user.last_name }}&nbsp;<span class="caret"></span></i>
                            </a>
                            <ul class="dropdown-menu dropdown-user">
								<li>
									<a href="{% url 'user_profile' %}"><i class="fa fa-user fa-fw"></i> Mon profil</a>
								</li>
								{% comment %}
								<li>
									<a href="#"><i class="fa fa-gear fa-fw"></i> Configuration</a>
								</li>
								{% endcomment %}
								<li class="divider"></li>
								<li>
									<a href="{% url 'logout' %}?next=/elocus/"><i class="fa fa-sign-out fa-fw"></i> Déconnexion</a>
								</li>
                            </ul>
                            <!-- /.dropdown-user -->
                        </li>
                        {% endif %}
						{% comment %}
                        <li>
							<form class="navbar-form navbar-left" role="search">
								<div class="form-group input-group custom-search-form">
                                    <input type="text" placeholder="Search..." class="form-control">
	                                <span class="input-group-btn">
	                                <button type="button" class="btn btn-default">
	                                    <i class="fa fa-search"></i>
	                                </button>
	                            </span>
	                            </div>
                            </form>
		    			</li>
						{% endcomment %}
						<li>
							<button id="fullscreen" type="button" class="btn btn-default navbar-btn hidden-xs" data-toggle="modal" data-target="#FullScreenModal">
								<a title="Plein écran" data-action="launchFullscreen" href="javascript:void(0);"><i class="fa fa-arrows-alt"></i></a>
							</button>
						</li>
					</ul>
					
				</div><!--/.nav-collapse -->
			</div>
		</nav>

		{% comment "Test variables with" %}		
			{% with test=True %}
							
				<div class="jumbotron">
				  <h1>
				  	{{ test }}
				  	{% if test %}
						___test true				
					{% else %}
						___test false				
					{% endif %}
				  </h1>
				</div>
			{% endwith %}
		{% endcomment %}	
	

		{% block page-content %}{% endblock %}


		<footer class="footer">
	        <div class="container-fluid">
	            <div class="row">
	                <div class="col-md-12">
	                    <span class="copyright">Copyright © 2016</span>
	                </div>
	                
	                {% comment %}
	                <div class="col-md-offset-4 col-md-4">
	                    <ul class="list-inline social-buttons">
	                        <li><a href="https://twitter.com/ecorse"><i class="fa fa-twitter"></i></a>
	                        </li>
	                        <li><a href="https://www.facebook.com/ecorse/"><i class="fa fa-facebook"></i></a>
	                        </li>          
	                    </ul>
	                </div>
	                {% endcomment %}
	            </div>
	        </div>
	    </footer>

		<!-- Bouton retour haut de page -->
	    <div id="toTop">
			<a id="topTopLink" href="#" title="haut de page"><i class="fa fa-hand-o-up fa-2x" aria-hidden="true"></i></a>
		</div>

		<!-- Modal pour explication full screen -->
		<div class="modal fade hidden-xs" id="FullScreenModal" tabindex="-1" role="dialog" aria-labelledby="FullScreenModalLabel">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title" id="myModalLabel">Passer en mode plein écran</h4>
					</div>
					<div class="modal-body">
						<p>
							Pour enclencher la fonction plein écran, utilisez la touche <strong>F11</strong> de votre clavier. Celle-ci permet de faire basculer votre navigateur entre le mode normal et le mode plein écran.<br>
							Pour sortir du mode plein écran, utilisez la touche <strong>echap</strong> ou de nouveau la touche F11.  
						</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
					</div>
				</div>
			</div>
		</div>

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<script src="/static/jquery.js"></script>
		<script src="/static/jquery-ui.min.js"></script>
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="/static/bootstrap/js/bootstrap.min.js"></script>
		<script src="/static/bootstrap3-typeahead.min.js"></script>
		
		{# <script src="/settings.js"></script> #}
		<!--
		<script src="/static/js/kolekti-utils.js"></script>
		<script src="/static/js/kolekti-common.js"></script>
		-->

		{# scripts additionnels Felix #}
		{# retiré car sort du plein écran lorsqu'on change d'url <script src="/static/js/screenfull.min.js"></script> cf. https://github.com/sindresorhus/screenfull.js #}
		<script>			
			
			$(function() {
				// jQuery for page scrolling feature - requires jQuery Easing plugin
			    $('a.page-scroll').bind('click', function(event) {
			        var $anchor = $(this);
			        $('html, body').stop().animate({
			            scrollTop: $($anchor.attr('href')).offset().top
			        }, 1500, 'easeInOutExpo');
			        event.preventDefault();
			    });

			    /* retiré car sort du plein écran lorsqu'on change d'url
			    //full screen avec sreenfull.js
			    if (typeof screenfull == 'undefined') {
			    	$('#fullscreen').hide();
			    }    
			    $('#fullscreen').click (() => {
				    if (screenfull.enabled) {
				        //screenfull.toggle();
				        screenfull.request();
			        }
				}); */


				// fonctions pour harmoniser les hauteurs aprés un changement de taille d'écran
				var mapsReady = ($(".leafletmap").length == 0);
				var chartsReady = ($(".ecorse-chart").length == 0);
				doResizeActions(mapsReady, chartsReady);
				$('body').on("displayed.topics.alaune", function(e, component) { //evt déclarés dans chart.js et map.js
					if(component == 'map') mapsReady = true;
					if(component == 'chart') chartsReady = true;					
		doResizeActions(mapsReady, chartsReady);
		if(mapsReady && chartsReady) {
		doOpenTopic();
		}
				});
				$( window ).resize(function() {
					doResizeActions(mapsReady, chartsReady);
				});


				//pour ouverture accordéon quand on suit un lien d'indicateur à la une
		var doOpenTopic = function() {
		var pageUrl = window.location.href;
		var hasEltIdInPageUrl = pageUrl.indexOf("#"); 
		if (hasEltIdInPageUrl != -1) {
		if (!$('body').data('opened')) {
		var eltIdInPageUrl = '#' + pageUrl.split('#')[1];
		console.log($(eltIdInPageUrl).closest(".section-content.collapse"));

		                        $(eltIdInPageUrl).parents().collapse('show');
		$(eltIdInPageUrl).closest(".section-content.collapse").trigger("shown.elocus.section");
		
					$('html, body').animate({
						scrollTop: $(eltIdInPageUrl).offset().top - 60
					}, 1000);
				}
		}
		$('body').data('opened',true);
		}

			});

			function doResizeActions(mapsReady, chartsReady) {
		console.log ("doResizeActions (mapsReady:" + mapsReady + ", chartsReady:" + chartsReady + ")");
		
				if(mapsReady && chartsReady) {
					$('.accueil.sections').each(function(){
						equalizePanelHeadings(this);						
					});
					$('.accueil.alaune .panel-body').each(function(){
						equalizeTopics(this);						
					});
					$('.panel-collapse.in').each(function(){
						equalizeTopics(this);						
		});


				}
			}

			function equalizePanelHeadings(elt) {
				var maxHeight = 0;
				var panelHeadings = $('.panel .panel-heading',elt);
				//on enlève la spécification assignée par un appel précédent à cette fonction
				$(panelHeadings).css('height', 'inherit');
				// Select and loop the elements you want to equalise
				$(panelHeadings).each(function(){
					if($(this).height() > maxHeight) {
					  maxHeight = $(this).height(); 
					}
				}); 
				// Set the height of all those children to whichever was highest 
				$(panelHeadings).height(maxHeight);
			}

			function equalizeTopics(elt) {
				var maxHeightHeadings = 0;
				var panelHeadings = $('.panel .panel-heading',elt);
				//on enlève la spécification assignée par un appel précédent à cette fonction
				$(panelHeadings).css('height', 'inherit');
				// Select and loop the elements you want to equalise
				$(panelHeadings).each(function(){
					if($(this).height() > maxHeightHeadings) {
					  maxHeightHeadings = $(this).height(); 
					}
				}); 
				// Set the height of all those children to whichever was highest 
				$(panelHeadings).height(maxHeightHeadings);

				var maxHeightBodys = 0;
				var panelBodys = $('.panel .panel-body',elt);
				//on enlève la spécification assignée par un appel précédent à cette fonction
				$(panelBodys).css('height', 'inherit');
				// Select and loop the elements you want to equalise
				$(panelBodys).each(function(){
					if($(this).height() > maxHeightBodys) {
					  maxHeightBodys = $(this).height(); 
					}
				}); 
				// Set the height of all those children to whichever was highest 
				$(panelBodys).height(maxHeightBodys);
			}

			// *** retour haut de page
			$(window).scroll(function(){
				posScroll = $(document).scrollTop();
				if(posScroll >=300) {
					$('#topTopLink').fadeIn(600);
					$('#topTopLink').css('display','block');
				} else {
					$('#topTopLink').fadeOut(600);
				}
			});
			$('#topTopLink').click(function(){
				$('html').animate({scrollTop:0}, 'slow');
				return false;
			});

			/* $('.sidebar').affix({
			    offset: {
			        top: 100,
			        bottom: function () {
			            return (this.bottom = $('.footer').outerHeight(true))
			        }
			    }
			}) */
		</script>
		{# fin scripts additionnels Felix #}
	
		{% block extrascripts %}{% endblock %}
	
	</body>
</html>

(function(){var j=function(f,h){var d={},i=function(g){critexps=g.split(";");$.each(critexps,function(e,c){if(0!=c.length){var a="=\\",a=c.match(/= *\\?/)[0];critvals=c.split(a);var b=critvals[0].trim();d[b].operator=a.replace(" ","");d[b].values=[];$.each(critvals[1].split(","),function(a,c){d[b].values.push(c.trim())})}});return critexps};return{title:f.lang.conditions.title,minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Critères",elements:function(){var g=[],e=function(a){var b="",
c=!0;$.each(d,function(a,d){d.values.length&&(c||(b+=" ; "),c=!1,b+=d.code,b+=" ",b+=d.operator,b+=" ",$.each(d.values,function(a,d){0<a&&(b+=" , ");b+=d}))});a.getContentElement("tab-basic","cond_ID").setValue(b,!1)},c=$("body").data("project"),c=Urls.kolekti_criteria_json(c);$.ajax({type:"GET",url:c,contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(a){$.each(a,function(b,a){d[b]={code:b,def:a,operator:"=",values:[]};var c=[];c.push(["-- select --",""]);$.each(a,
function(b,a){c.push([a,a])});g.push({type:"hbox",widths:["280px","110px"],align:"left",children:[{type:"html",html:'<span class="condition_dialoglabel">'+b+"</span>"},{type:"select",id:"operator_ID_"+b,items:[[" = ","="],["= \\ ","= \\"]],"default":"=",onChange:function(){var a=this.getValue();d[b].operator=a;e(this.getDialog())}},{type:"select",id:"crit_ID_"+b,items:c,onClick:function(){var a=this.getValue();a.length&&-1==d[b].values.indexOf(a)&&d[b].values.push(a);e(this.getDialog());this.setValue("")}},
{type:"button",id:"del_ID_"+b,label:"X",onClick:function(){d[b].values=[];d[b].operator="=";e(this.getDialog())}}]})})},error:function(a,b,c){alert(a.status);alert(c)}});g.push({type:"hbox",widths:["280px","110px"],align:"left",children:[{type:"text",id:"cond_ID",label:"Expression condition :",validate:function(){console.log("validate")},setup:function(){console.log("setup")},onChange:function(){console.log("onChange "+h);i(this.getValue())},onShow:function(){console.log("onShow "+h);var a=f.plugins.showblocks.getselectedblock(f);
a&&a.count()&&(a=a.getItem(0),this.setValue(a.getAttribute("class"),!1),i(this.getValue()))}}]});return g}()}],onShow:function(){$.each(d,function(d,e){e.values=[];e.operator="="})},onOk:function(){var d=this.getValueOf("tab-basic","cond_ID"),e,c=f.plugins.showblocks.getselectedblock(f);if(c)for(var a=0;a<c.count();a++)e=c.getItem(a),e.setAttribute("class",d)}}};CKEDITOR.dialog.add("editCondition",function(f){return j(f,"edit")})})();
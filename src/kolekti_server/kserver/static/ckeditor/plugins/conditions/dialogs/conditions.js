(function(){var j=function(d,h){var c={},i=function(g){critexps=g.split(";");$.each(critexps,function(e,b){if(0!=b.length){var a="=\\",a=b.match(/= *\\?/)[0];critvals=b.split(a);var f=critvals[0].trim();c[f].operator=a.replace(" ","");c[f].values=[];$.each(critvals[1].split(","),function(a,b){c[f].values.push(b.trim())})}});return critexps};return{title:d.lang.conditions.title,minWidth:400,minHeight:200,contents:[{id:"tab-basic",label:"Critères",elements:function(){var g=[],e=function(b){var a="",
f=!0;$.each(c,function(b,c){c.values.length&&(f||(a+=" ; "),f=!1,a+=c.code,a+=" ",a+=c.operator,a+=" ",$.each(c.values,function(b,c){0<b&&(a+=" , ");a+=c}))});b.getContentElement("tab-basic","cond_ID").setValue(a,!1)};$.ajax({type:"GET",url:"/criteria.json",contentType:"application/json; charset=utf-8",dataType:"json",async:!1,success:function(b){$.each(b,function(a,b){c[a]={code:a,def:b,operator:"=",values:[]};var d=[];d.push(["-- select --",""]);$.each(b,function(a,b){d.push([b,b])});g.push({type:"hbox",
widths:["280px","110px"],align:"left",children:[{type:"html",html:'<span class="condition_dialoglabel">'+a+"</span>"},{type:"select",id:"operator_ID_"+a,items:[[" = ","="],["= \\ ","= \\"]],"default":"=",onChange:function(){var b=this.getValue();c[a].operator=b;e(this.getDialog())}},{type:"select",id:"crit_ID_"+a,items:d,onClick:function(){var b=this.getValue();b.length&&-1==c[a].values.indexOf(b)&&c[a].values.push(b);e(this.getDialog());this.setValue("")}},{type:"button",id:"del_ID_"+a,label:"X",
onClick:function(){c[a].values=[];c[a].operator="=";e(this.getDialog())}}]})})},error:function(b,a,c){alert(b.status);alert(c)}});g.push({type:"hbox",widths:["280px","110px"],align:"left",children:[{type:"text",id:"cond_ID",label:"Expression condition :",validate:function(){console.log("validate")},setup:function(){console.log("setup")},onChange:function(){console.log("onChange "+h);i(this.getValue())},onShow:function(){console.log("onShow "+h);var b=d.plugins.showblocks.getselectedblock(d);b&&b.count()&&
(b=b.getItem(0),this.setValue(b.getAttribute("class"),!1),i(this.getValue()))}}]});return g}()}],onShow:function(){$.each(c,function(c,d){d.values=[];d.operator="="})},onOk:function(){var c=this.getValueOf("tab-basic","cond_ID"),e,b=d.plugins.showblocks.getselectedblock(d);if(b)for(var a=0;a<b.count();a++)e=b.getItem(a),e.setAttribute("class",c)}}};CKEDITOR.dialog.add("editCondition",function(d){return j(d,"edit")})})();
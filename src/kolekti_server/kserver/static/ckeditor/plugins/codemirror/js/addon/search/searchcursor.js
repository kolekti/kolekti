(function(g){"object"==typeof exports&&"object"==typeof module?g(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],g):g(CodeMirror)})(function(g){function o(e,b,c,a){this.atOccurrence=!1;this.doc=e;null==a&&"string"==typeof b&&(a=!1);c=c?e.clipPos(c):i(0,0);this.pos={from:c,to:c};if("string"!=typeof b)b.global||(b=RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,l){if(c){b.lastIndex=0;for(var a=e.getLine(l.line).slice(0,l.ch),f=0,
d,h;;){b.lastIndex=f;f=b.exec(a);if(!f)break;d=f;h=d.index;f=d.index+(d[0].length||1);if(f==a.length)break}(f=d&&d[0].length||0)||(0==h&&0==a.length?d=void 0:h!=e.getLine(l.line).length&&f++)}else b.lastIndex=l.ch,a=e.getLine(l.line),f=(d=b.exec(a))&&d[0].length||0,h=d&&d.index,h+f!=a.length&&!f&&(f=1);if(d&&f)return{from:i(l.line,h),to:i(l.line,h+f),match:d}};else{var g=b;a&&(b=b.toLowerCase());var k=a?function(b){return b.toLowerCase()}:function(b){return b},j=b.split("\n");if(1==j.length)this.matches=
b.length?function(c,a){if(c){var n=e.getLine(a.line).slice(0,a.ch),f=k(n),d=f.lastIndexOf(b);if(-1<d)return d=p(n,f,d),{from:i(a.line,d),to:i(a.line,d+g.length)}}else if(n=e.getLine(a.line).slice(a.ch),f=k(n),d=f.indexOf(b),-1<d)return d=p(n,f,d)+a.ch,{from:i(a.line,d),to:i(a.line,d+g.length)}}:function(){};else{var m=g.split("\n");this.matches=function(b,a){var c=j.length-1;if(b){if(!(a.line-(j.length-1)<e.firstLine())&&k(e.getLine(a.line).slice(0,m[c].length))==j[j.length-1]){for(var f=i(a.line,
m[c].length),d=a.line-1,h=c-1;1<=h;--h,--d)if(j[h]!=k(e.getLine(d)))return;var h=e.getLine(d),g=h.length-m[0].length;if(k(h.slice(g))==j[0])return{from:i(d,g),to:f}}}else if(!(a.line+(j.length-1)>e.lastLine())&&(h=e.getLine(a.line),g=h.length-m[0].length,k(h.slice(g))==j[0])){f=i(a.line,g);d=a.line+1;for(h=1;h<c;++h,++d)if(j[h]!=k(e.getLine(d)))return;if(k(e.getLine(d).slice(0,m[c].length))==j[c])return{from:f,to:i(d,m[c].length)}}}}}}function p(e,b,c){if(e.length==b.length)return c;for(b=Math.min(c,
e.length);;){var a=e.slice(0,b).toLowerCase().length;if(a<c)++b;else if(a>c)--b;else return b}}var i=g.Pos;o.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function b(a){a=i(a,0);c.pos={from:a,to:a};return c.atOccurrence=!1}for(var c=this,a=this.doc.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,a))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!a.line)return b(0);a=i(a.line-1,this.doc.getLine(a.line-
1).length)}else{var g=this.doc.lineCount();if(a.line==g-1)return b(g);a=i(a.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,b){if(this.atOccurrence){var c=g.splitLines(e);this.doc.replaceRange(c,this.pos.from,this.pos.to,b);this.pos.to=i(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};g.defineExtension("getSearchCursor",function(e,b,c){return new o(this.doc,e,b,
c)});g.defineDocExtension("getSearchCursor",function(e,b,c){return new o(this,e,b,c)});g.defineExtension("selectMatches",function(e,b){for(var c=[],a=this.getSearchCursor(e,this.getCursor("from"),b);a.findNext()&&!(0<g.cmpPos(a.to(),this.getCursor("to")));)c.push({anchor:a.from(),head:a.to()});c.length&&this.setSelections(c,0)})});
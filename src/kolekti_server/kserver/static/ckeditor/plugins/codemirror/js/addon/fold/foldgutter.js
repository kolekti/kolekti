(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./foldcode")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./foldcode"],e):e(CodeMirror)})(function(e){function o(a){this.options=a;this.from=this.to=0}function j(a,b){for(var c=a.findMarksAt(i(b)),d=0;d<c.length;++d)if(c[d].__isFold&&c[d].find().from.line==b)return c[d]}function k(a){if("string"==typeof a){var b=document.createElement("div");b.className=a+" CodeMirror-guttermarker-subtle";
return b}return a.cloneNode(!0)}function g(a,b,c){var d=a.state.foldGutter.options,e=b,h=a.foldOption(d,"minFoldSize"),g=a.foldOption(d,"rangeFinder");a.eachLine(b,c,function(b){var c=null;if(j(a,e))c=k(d.indicatorFolded);else{var f=i(e,0);(f=g&&g(a,f))&&f.to.line-f.from.line>=h&&(c=k(d.indicatorOpen))}a.setGutterMarker(b,d.gutter,c);++e})}function h(a){var b=a.getViewport(),c=a.state.foldGutter;c&&(a.operation(function(){g(a,b.from,b.to)}),c.from=b.from,c.to=b.to)}function l(a,b,c){var d=a.state.foldGutter;
d&&(d=d.options,c==d.gutter&&((c=j(a,b))?c.clear():a.foldCode(i(b,0),d.rangeFinder)))}function m(a){var b=a.state.foldGutter;if(b){var c=b.options;b.from=b.to=0;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){h(a)},c.foldOnChangeTimeSpan||600)}}function n(a){var b=a.state.foldGutter;if(b){var c=b.options;clearTimeout(b.changeUpdate);b.changeUpdate=setTimeout(function(){var c=a.getViewport();b.from==b.to||20<c.from-b.to||20<b.from-c.to?h(a):a.operation(function(){c.from<b.from&&(g(a,
c.from,b.from),b.from=c.from);c.to>b.to&&(g(a,b.to,c.to),b.to=c.to)})},c.updateViewportTimeSpan||400)}}function f(a,b){var c=a.state.foldGutter;if(c){var d=b.line;d>=c.from&&d<c.to&&g(a,d,d+1)}}e.defineOption("foldGutter",!1,function(a,b,c){if(c&&c!=e.Init){a.clearGutter(a.state.foldGutter.options.gutter);a.state.foldGutter=null;a.off("gutterClick",l);a.off("change",m);a.off("viewportChange",n);a.off("fold",f);a.off("unfold",f);a.off("swapDoc",h)}if(b){c=a.state;b===true&&(b={});if(b.gutter==null)b.gutter=
"CodeMirror-foldgutter";if(b.indicatorOpen==null)b.indicatorOpen="CodeMirror-foldgutter-open";if(b.indicatorFolded==null)b.indicatorFolded="CodeMirror-foldgutter-folded";c.foldGutter=new o(b);h(a);a.on("gutterClick",l);a.on("change",m);a.on("viewportChange",n);a.on("fold",f);a.on("unfold",f);a.on("swapDoc",h)}});var i=e.Pos});
(function(){function k(d,b,k,p){var a,q,h,i,l,r,n,s,t,j,u,b=b||{};if((void 0===b.wrap_line_length||0===parseInt(b.wrap_line_length,10))&&void 0!==b.max_char&&0!==parseInt(b.max_char,10))b.wrap_line_length=b.max_char;q=void 0===b.indent_inner_html?!1:b.indent_inner_html;h=void 0===b.indent_size?4:parseInt(b.indent_size,10);i=void 0===b.indent_char?" ":b.indent_char;r=void 0===b.brace_style?"collapse":b.brace_style;l=0===parseInt(b.wrap_line_length,10)?32786:parseInt(b.wrap_line_length||250,10);n=b.unformatted||
"a span img bdo em strong dfn code samp kbd var cite abbr acronym q sub sup tt i b big small u s strike font ins del pre address dt h1 h2 h3 h4 h5 h6".split(" ");t=(s=void 0===b.preserve_newlines?!0:b.preserve_newlines)?isNaN(parseInt(b.max_preserve_newlines,10))?32786:parseInt(b.max_preserve_newlines,10):0;j=void 0===b.indent_handlebars?!1:b.indent_handlebars;u=void 0===b.end_with_newline?!1:b.end_with_newline;a=new function(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",
parentcount:1,parent1:""};this.token_text=this.last_token=this.last_text=this.token_type=this.tag_type="";this.newlines=0;this.indent_content=q;this.Utils={whitespace:["\n","\r","\t"," "],single_token:"br input link meta !doctype basefont base area hr wbr param img isindex ?xml embed ?php ? ?=".split(" "),extra_liners:["head","body","/html"],in_array:function(c,v){for(var a=0;a<v.length;a++)if(c===v[a])return!0;return!1}};this.is_whitespace=function(c){for(;0<c.length;c++)if(!this.Utils.in_array(c.charAt(0),
this.Utils.whitespace))return!1;return!0};this.traverse_whitespace=function(){var c="",c=this.input.charAt(this.pos);if(this.Utils.in_array(c,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(c,this.Utils.whitespace);)s&&("\n"===c&&this.newlines<=t)&&(this.newlines+=1),this.pos++,c=this.input.charAt(this.pos);return!0}return!1};this.space_or_wrap=function(c){this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,c),this.print_indentation(c)):(this.line_char_count++,c.push(" "))};
this.get_content=function(){for(var c="",a=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return a.length?a.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(a);else{if(j)if(c=this.input.substr(this.pos,3),"{{#"===c||"{{/"===c)break;else if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break;c=this.input.charAt(this.pos);this.pos++;this.line_char_count++;a.push(c)}}return a.length?a.join(""):""};this.get_contents_to=function(c){if(this.pos===
this.input.length)return["","TK_EOF"];var a="",c=RegExp("</"+c+"\\s*>","igm");c.lastIndex=this.pos;c=(c=c.exec(this.input))?c.index:this.input.length;this.pos<c&&(a=this.input.substring(this.pos,c),this.pos=c);return a};this.record_tag=function(c){this.tags[c+"count"]?this.tags[c+"count"]++:this.tags[c+"count"]=1;this.tags[c+this.tags[c+"count"]]=this.indent_level;this.tags[c+this.tags[c+"count"]+"parent"]=this.tags.parent;this.tags.parent=c+this.tags[c+"count"]};this.retrieve_tag=function(c){if(this.tags[c+
"count"]){for(var a=this.tags.parent;a&&c+this.tags[c+"count"]!==a;)a=this.tags[a+"parent"];a&&(this.indent_level=this.tags[c+this.tags[c+"count"]],this.tags.parent=this.tags[a+"parent"]);delete this.tags[c+this.tags[c+"count"]+"parent"];delete this.tags[c+this.tags[c+"count"]];1===this.tags[c+"count"]?delete this.tags[c+"count"]:this.tags[c+"count"]--}};this.indent_to_tag=function(c){if(this.tags[c+"count"]){for(var a=this.tags.parent;a&&c+this.tags[c+"count"]!==a;)a=this.tags[a+"parent"];a&&(this.indent_level=
this.tags[c+this.tags[c+"count"]])}};this.get_tag=function(c){var a="",e=[],a="",b=!1,f,g,d=this.pos,h=this.line_char_count,c=void 0!==c?c:!1;do{if(this.pos>=this.input.length)return c&&(this.pos=d,this.line_char_count=h),e.length?e.join(""):["","TK_EOF"];a=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(a,this.Utils.whitespace))b=!0;else{if("'"===a||'"'===a)a+=this.get_unformatted(a),b=!0;"="===a&&(b=!1);e.length&&("="!==e[e.length-1]&&">"!==a&&b)&&(this.space_or_wrap(e),b=!1);j&&"<"===
g&&"{{"===a+this.input.charAt(this.pos)&&(a+=this.get_unformatted("}}"),e.length&&(" "!==e[e.length-1]&&"<"!==e[e.length-1])&&(a=" "+a),b=!0);"<"===a&&!g&&(f=this.pos-1,g="<");j&&!g&&(2<=e.length&&"{"===e[e.length-1]&&"{"==e[e.length-2])&&(f="#"===a||"/"===a?this.pos-3:this.pos-2,g="{");this.line_char_count++;e.push(a);if(e[1]&&"!"===e[1]){e=[this.get_comment(f)];break}if(j&&"{"===g&&2<e.length&&"}"===e[e.length-2]&&"}"===e[e.length-1])break}}while(">"!==a);f=e.join("");g=-1!==f.indexOf(" ")?f.indexOf(" "):
"{"===f[0]?f.indexOf("}"):f.indexOf(">");g=f.substring("<"===f[0]||!j?1:"#"===f[2]?3:2,g).toLowerCase();if("/"===f.charAt(f.length-2)||this.Utils.in_array(g,this.Utils.single_token))c||(this.tag_type="SINGLE");else if(j&&"{"===f[0]&&"else"===g)c||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace());else if(this.is_unformatted(g,n))a=this.get_unformatted("</"+g+">",f),e.push(a),this.tag_type="SINGLE";else if("script"===g&&(-1===f.search("type")||
-1<f.search("type")&&-1<f.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript)/)))c||(this.record_tag(g),this.tag_type="SCRIPT");else if("style"===g&&(-1===f.search("type")||-1<f.search("type")&&-1<f.search("text/css")))c||(this.record_tag(g),this.tag_type="STYLE");else if("!"===g.charAt(0))c||(this.tag_type="SINGLE",this.traverse_whitespace());else if(!c&&("/"===g.charAt(0)?(this.retrieve_tag(g.substring(1)),this.tag_type="END"):(this.record_tag(g),"html"!==g.toLowerCase()&&
(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(e),this.Utils.in_array(g,this.Utils.extra_liners)))this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output);c&&(this.pos=d,this.line_char_count=h);return e.join("")};this.get_comment=function(a){var b="",e=">",d=!1;this.pos=a;input_char=this.input.charAt(this.pos);for(this.pos++;this.pos<=this.input.length;){b+=input_char;if(b[b.length-
1]===e[e.length-1]&&-1!==b.indexOf(e))break;!d&&10>b.length&&(0===b.indexOf("<![if")?(e="<![endif]>",d=!0):0===b.indexOf("<![cdata[")?(e="]]\>",d=!0):0===b.indexOf("<![")?(e="]>",d=!0):0===b.indexOf("<\!--")&&(e="--\>",d=!0));input_char=this.input.charAt(this.pos);this.pos++}return b};this.get_unformatted=function(a,b){if(b&&-1!==b.toLowerCase().indexOf(a))return"";var e="",d="",f=0,g=!0;do{if(this.pos>=this.input.length)break;e=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(e,this.Utils.whitespace)){if(!g){this.line_char_count--;
continue}if("\n"===e||"\r"===e){d+="\n";this.line_char_count=0;continue}}d+=e;this.line_char_count++;g=!0;j&&("{"===e&&d.length&&"{"===d[d.length-2])&&(d+=this.get_unformatted("}}"),f=d.length)}while(-1===d.toLowerCase().indexOf(a,f));return d};this.get_token=function(){var a;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var b=this.last_token.substr(7);a=this.get_contents_to(b);return"string"!==typeof a?a:[a,"TK_"+b]}if("CONTENT"===this.current_mode)return a=this.get_content(),
"string"!==typeof a?a:[a,"TK_CONTENT"];if("TAG"===this.current_mode)return a=this.get_tag(),"string"!==typeof a?a:[a,"TK_TAG_"+this.tag_type]};this.get_full_indent=function(a){a=this.indent_level+a||0;return 1>a?"":Array(a+1).join(this.indent_string)};this.is_unformatted=function(a,b){if(!this.Utils.in_array(a,b))return!1;if("a"!==a.toLowerCase()||!this.Utils.in_array("a",b))return!0;var e=(this.get_tag(!0)||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!e||this.Utils.in_array(e,b)?!0:!1};this.printer=
function(a,b,e,d,f){this.input=a||"";this.output=[];this.indent_character=b;this.indent_string="";this.indent_size=e;this.brace_style=f;this.indent_level=0;this.wrap_line_length=d;for(a=this.line_char_count=0;a<this.indent_size;a++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0;if(b&&b.length&&(a||"\n"!==b[b.length-1]))"\n"!==b[b.length-1]&&(b[b.length-1]=b[b.length-1].replace(/\s+$/g,"")),b.push("\n")};this.print_indentation=function(a){for(var b=
0;b<this.indent_level;b++)a.push(this.indent_string),this.line_char_count+=this.indent_string.length};this.print_token=function(a){if(!this.is_whitespace(a)||this.output.length){if((a||""!==a)&&this.output.length&&"\n"===this.output[this.output.length-1])this.print_indentation(this.output),a=a.replace(/^\s+/g,"");this.print_token_raw(a)}};this.print_token_raw=function(a){0<this.newlines&&(a=a.replace(/\s+$/g,""));a&&""!==a&&(1<a.length&&"\n"===a[a.length-1]?(this.output.push(a.slice(0,-1)),this.print_newline(!1,
this.output)):this.output.push(a));for(a=0;a<this.newlines;a++)this.print_newline(0<a,this.output);this.newlines=0};this.indent=function(){this.indent_level++};this.unindent=function(){0<this.indent_level&&this.indent_level--}};return this};for(a.printer(d,i,h,l,r);;){d=a.get_token();a.token_text=d[0];a.token_type=d[1];if("TK_EOF"===a.token_type)break;switch(a.token_type){case "TK_TAG_START":a.print_newline(!1,a.output);a.print_token(a.token_text);a.indent_content&&(a.indent(),a.indent_content=!1);
a.current_mode="CONTENT";break;case "TK_TAG_STYLE":case "TK_TAG_SCRIPT":a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_END":"TK_CONTENT"===a.last_token&&""===a.last_text&&(d=a.token_text.match(/\w+/)[0],h=null,a.output.length&&(h=a.output[a.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),(null===h||h[1]!==d)&&a.print_newline(!1,a.output));a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_SINGLE":d=a.token_text.match(/^\s*<([a-z-]+)/i);
(!d||!a.Utils.in_array(d[1],n))&&a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_HANDLEBARS_ELSE":a.print_token(a.token_text);a.indent_content&&(a.indent(),a.indent_content=!1);a.current_mode="CONTENT";break;case "TK_CONTENT":a.print_token(a.token_text);a.current_mode="TAG";break;case "TK_STYLE":case "TK_SCRIPT":if(""!==a.token_text){a.print_newline(!1,a.output);var d=a.token_text,m;i=1;"TK_SCRIPT"===a.token_type?m="function"===typeof k&&k:"TK_STYLE"===
a.token_type&&(m="function"===typeof p&&p);"keep"===b.indent_scripts?i=0:"separate"===b.indent_scripts&&(i=-a.indent_level);h=a.get_full_indent(i);m?d=m(d.replace(/^\s*/,h),b):(l=d.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(a.indent_string).length-1,i=a.get_full_indent(i-l),d=d.replace(/^\s*/,h).replace(/\r\n|\r|\n/g,"\n"+i).replace(/\s+$/,""));d&&(a.print_token_raw(d),a.print_newline(!0,a.output))}a.current_mode="TAG";break;default:""!==a.token_text&&a.print_token(a.token_text)}a.last_token=a.token_type;
a.last_text=a.token_text}b=a.output.join("").replace(/[\r\n\t ]+$/,"");u&&(b+="\n");return b}if("function"===typeof define&&define.amd)define(["require","./beautify","./beautify-css"],function(d){var b=d("./beautify"),o=d("./beautify-css");return{html_beautify:function(d,a){return k(d,a,b.js_beautify,o.css_beautify)}}});else if("undefined"!==typeof exports){var o=require("./beautify.js"),w=require("./beautify-css.js");exports.html_beautify=function(d,b){return k(d,b,o.js_beautify,w.css_beautify)}}else"undefined"!==
typeof window?window.html_beautify=function(d,b){return k(d,b,window.js_beautify,window.css_beautify)}:"undefined"!==typeof global&&(global.html_beautify=function(d,b){return k(d,b,global.js_beautify,global.css_beautify)})})();
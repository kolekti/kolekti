(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function p(a,c,b,e){var d=a.getLineHandle(c.line),h=c.ch-1,d=0<=h&&o[d.text.charAt(h)]||o[d.text.charAt(++h)];if(!d)return null;var g=">"==d.charAt(1)?1:-1;if(b&&0<g!=(h==c.ch))return null;b=a.getTokenTypeAt(j(c.line,h+1));a=q(a,j(c.line,h+(0<g?1:0)),g,b||null,e);return null==a?null:{from:j(c.line,h),
to:a&&a.pos,match:a&&a.ch==d.charAt(0),forward:0<g}}function q(a,c,b,e,d){for(var h=d&&d.maxScanLineLength||1E4,g=d&&d.maxScanLines||1E3,f=[],d=d&&d.bracketRegex?d.bracketRegex:/[(){}[\]]/,g=0<b?Math.min(c.line+g,a.lastLine()+1):Math.max(a.firstLine()-1,c.line-g),i=c.line;i!=g;i+=b){var m=a.getLine(i);if(m){var k=0<b?0:m.length-1,l=0<b?m.length:-1;if(!(m.length>h))for(i==c.line&&(k=c.ch-(0>b?1:0));k!=l;k+=b){var n=m.charAt(k);if(d.test(n)&&(void 0===e||a.getTokenTypeAt(j(i,k+1))==e))if(">"==o[n].charAt(1)==
0<b)f.push(n);else if(f.length)f.pop();else return{pos:j(i,k),ch:n}}}}return i-b==(0<b?a.lastLine():a.firstLine())?!1:null}function r(a,c,b){for(var e=a.state.matchBrackets.maxHighlightLineLength||1E3,d=[],h=a.listSelections(),g=0;g<h.length;g++){var f=h[g].empty()&&p(a,h[g].head,!1,b);if(f&&a.getLine(f.from.line).length<=e){var i=f.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";d.push(a.markText(f.from,j(f.from.line,f.from.ch+1),{className:i}));f.to&&a.getLine(f.to.line).length<=
e&&d.push(a.markText(f.to,j(f.to.line,f.to.ch+1),{className:i}))}}if(d.length)if(t&&a.state.focused&&a.focus(),b=function(){a.operation(function(){for(var a=0;a<d.length;a++)d[a].clear()})},c)setTimeout(b,800);else return b}function s(a){a.operation(function(){l&&(l(),l=null);l=r(a,!1,a.state.matchBrackets)})}var t=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),j=e.Pos,o={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},l=null;e.defineOption("matchBrackets",
!1,function(a,c,b){b&&b!=e.Init&&a.off("cursorActivity",s);if(c){a.state.matchBrackets=typeof c=="object"?c:{};a.on("cursorActivity",s)}});e.defineExtension("matchBrackets",function(){r(this,!0)});e.defineExtension("findMatchingBracket",function(a,c,b){return p(this,a,c,b)});e.defineExtension("scanForBracket",function(a,c,b,e){return q(this,a,c,b,e)})});
(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function o(b,a){return"pairs"==a&&"string"==typeof b?b:"object"==typeof b&&null!=b[a]?b[a]:s[a]}function v(b){return function(a){return w(a,b)}}function p(b){var a=b.state.closeBrackets;return!a?null:b.getModeAt(b.getCursor()).closeBrackets||a}function w(b,a){var c=p(b);if(!c||b.getOption("disableInput"))return e.Pass;
var d=o(c,"pairs"),g=d.indexOf(a);if(-1==g)return e.Pass;for(var c=o(c,"triples"),q=d.charAt(g+1)==a,t=b.listSelections(),k=0==g%2,j,h,m=0;m<t.length;m++){var n=t[m],f=n.head;h=b.getRange(f,i(f.line,f.ch+1));if(k&&!n.empty())h="surround";else if((q||!k)&&h==a)h=0<=c.indexOf(a)&&b.getRange(f,i(f.line,f.ch+3))==a+a+a?"skipThree":"skip";else if(q&&1<f.ch&&0<=c.indexOf(a)&&b.getRange(i(f.line,f.ch-2),f)==a+a&&(2>=f.ch||b.getRange(i(f.line,f.ch-3),i(f.line,f.ch-2))!=a))h="addFour";else if(q)if(!e.isWordChar(h)&&
x(b,f,a))h="both";else return e.Pass;else if(k&&(b.getLine(f.line).length==f.ch||y(h,d)||/\s/.test(h)))h="both";else return e.Pass;if(j){if(j!=h)return e.Pass}else j=h}var l=g%2?d.charAt(g-1):a,r=g%2?a:d.charAt(g+1);b.operation(function(){if("skip"==j)b.execCommand("goCharRight");else if("skipThree"==j)for(var a=0;3>a;a++)b.execCommand("goCharRight");else if("surround"==j){for(var c=b.getSelections(),a=0;a<c.length;a++)c[a]=l+c[a]+r;b.replaceSelections(c,"around")}else"both"==j?(b.replaceSelection(l+
r,null),b.triggerElectric(l+r),b.execCommand("goCharLeft")):"addFour"==j&&(b.replaceSelection(l+l+l+l,"before"),b.execCommand("goCharRight"))})}function y(b,a){var c=a.lastIndexOf(b);return-1<c&&1==c%2}function u(b,a){var c=b.getRange(i(a.line,a.ch-1),i(a.line,a.ch+1));return 2==c.length?c:null}function x(b,a,c){var d=b.getLine(a.line),g=b.getTokenAt(a);if(/\bstring2?\b/.test(g.type))return!1;c=new e.StringStream(d.slice(0,a.ch)+c+d.slice(a.ch),4);for(c.pos=c.start=g.start;;){d=b.getMode().token(c,
g.state);if(c.pos>=a.ch+1)return/\bstring2?\b/.test(d);c.start=c.pos}}var s={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},i=e.Pos;e.defineOption("autoCloseBrackets",!1,function(b,a,c){if(c&&c!=e.Init){b.removeKeyMap(m);b.state.closeBrackets=null}if(a){b.state.closeBrackets=a;b.addKeyMap(m)}});for(var n=s.pairs+"`",m={Backspace:function(b){var a=p(b);if(!a||b.getOption("disableInput"))return e.Pass;for(var c=o(a,"pairs"),a=b.listSelections(),d=0;d<a.length;d++){if(!a[d].empty())return e.Pass;var g=
u(b,a[d].head);if(!g||0!=c.indexOf(g)%2)return e.Pass}for(d=a.length-1;0<=d;d--)c=a[d].head,b.replaceRange("",i(c.line,c.ch-1),i(c.line,c.ch+1))},Enter:function(b){var a=p(b),a=a&&o(a,"explode");if(!a||b.getOption("disableInput"))return e.Pass;for(var c=b.listSelections(),d=0;d<c.length;d++){if(!c[d].empty())return e.Pass;var g=u(b,c[d].head);if(!g||0!=a.indexOf(g)%2)return e.Pass}b.operation(function(){b.replaceSelection("\n\n",null);b.execCommand("goCharLeft");c=b.listSelections();for(var a=0;a<
c.length;a++){var d=c[a].head.line;b.indentLine(d,null,!0);b.indentLine(d+1,null,!0)}})}},k=0;k<n.length;k++)m["'"+n.charAt(k)+"'"]=v(n.charAt(k))});
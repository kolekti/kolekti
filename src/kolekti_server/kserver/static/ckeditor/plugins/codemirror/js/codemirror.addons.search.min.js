(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function m(a,f,b){var d;return d=a.getWrapperElement().appendChild(document.createElement("div")),d.className=b?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof f?d.innerHTML=f:d.appendChild(f),d}function q(a,f){a.state.currentNotificationClose&&a.state.currentNotificationClose();
a.state.currentNotificationClose=f}a.defineExtension("openDialog",function(e,f,b){function d(a){if("string"==typeof a)c.value=a;else if(!j&&(j=!0,i.parentNode.removeChild(i),k.focus(),b.onClose))b.onClose(i)}var c;b||(b={});q(this,null);var i=m(this,e,b.bottom),j=!1,k=this;if(c=i.getElementsByTagName("input")[0],c){if(b.value&&(c.value=b.value,!1!==b.selectValueOnOpen&&c.select()),b.onInput)a.on(c,"input",function(a){b.onInput(a,c.value,d)});if(b.onKeyUp)a.on(c,"keyup",function(a){b.onKeyUp(a,c.value,
d)});a.on(c,"keydown",function(e){b&&b.onKeyDown&&b.onKeyDown(e,c.value,d)||((27==e.keyCode||!1!==b.closeOnEnter&&13==e.keyCode)&&(c.blur(),a.e_stop(e),d()),13==e.keyCode&&f(c.value,e))});if(!1!==b.closeOnBlur)a.on(c,"blur",d);c.focus()}else if(e=i.getElementsByTagName("button")[0]){a.on(e,"click",function(){d();k.focus()});if(!1!==b.closeOnBlur)a.on(e,"blur",d);e.focus()}return d});a.defineExtension("openConfirm",function(e,f,b){function d(){j||(j=!0,i.parentNode.removeChild(i),k.focus())}var c;
q(this,null);var i=m(this,e,b&&b.bottom),b=i.getElementsByTagName("button"),j=!1,k=this,n=1;b[0].focus();for(e=0;e<b.length;++e)c=b[e],function(b){a.on(c,"click",function(f){a.e_preventDefault(f);d();b&&b(k)})}(f[e]),a.on(c,"blur",function(){--n;setTimeout(function(){0>=n&&d()},200)}),a.on(c,"focus",function(){++n})});a.defineExtension("openNotification",function(e,f){function b(){c||(c=!0,clearTimeout(i),d.parentNode.removeChild(d))}q(this,b);var d=m(this,e,f&&f.bottom),c=!1,i,j=f&&"undefined"!=
typeof f.duration?f.duration:5E3;a.on(d,"click",function(f){a.e_preventDefault(f);b()});return j&&(i=setTimeout(b,j)),b})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(a){function m(g,b){return"string"==typeof g?g=RegExp(g.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),b?"gi":"g"):g.global||(g=RegExp(g.source,g.ignoreCase?"gi":"g")),{token:function(b){g.lastIndex=b.pos;var a=
g.exec(b.string);if(a&&a.index==b.pos)return b.pos+=a[0].length,"searching";a?b.pos=a.index:b.skipToEnd()}}}function q(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function e(g){return g.state.search||(g.state.search=new q)}function f(g){return"string"==typeof g&&g==g.toLowerCase()}function b(g,b,a){return g.getSearchCursor(b,a,f(b))}function d(g,b,a,f){g.openDialog(b,f,{value:a,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){o(g)}})}function c(g,b,a,f,d){g.openDialog?
g.openDialog(b,d,{value:f,selectValueOnOpen:!0}):d(prompt(a,f))}function i(g,b,a,f){g.openConfirm?g.openConfirm(b,f):confirm(a)&&f[0]()}function j(g){var b=g.match(/^\/(.*)\/([a-z]*)$/);if(b)try{g=RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(a){}return("string"==typeof g?""==g:g.test(""))&&(g=/x^/),g}function k(b,a,d){a.queryText=d;a.query=j(d);b.removeOverlay(a.overlay,f(a.query));a.overlay=m(a.query,f(a.query));b.addOverlay(a.overlay);b.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),
a.annotate=null),a.annotate=b.showMatchesOnScrollbar(a.query,f(a.query)))}function n(b,f,h){var o=e(b),j;if(o.query)return r(b,f);j=b.getSelection()||o.lastQuery;h&&b.openDialog?d(b,l,j,function(f,d){(a.e_stop(d),f)&&(f!=o.queryText&&k(b,o,f),r(b,d.shiftKey))}):c(b,l,"Search for:",j,function(a){a&&!o.query&&b.operation(function(){k(b,o,a);o.posFrom=o.posTo=b.getCursor();r(b,f)})})}function r(g,f){g.operation(function(){var d=e(g),c=b(g,d.query,f?d.posFrom:d.posTo);(c.find(f)||(c=b(g,d.query,f?a.Pos(g.lastLine()):
a.Pos(g.firstLine(),0)),c.find(f)))&&(g.setSelection(c.from(),c.to()),g.scrollIntoView({from:c.from(),to:c.to()},20),d.posFrom=c.from(),d.posTo=c.to())})}function o(b){b.operation(function(){var a=e(b);(a.lastQuery=a.query,a.query)&&(a.query=a.queryText=null,b.removeOverlay(a.overlay),a.annotate&&(a.annotate.clear(),a.annotate=null))})}function s(a,f){if(!a.getOption("readOnly")){var d=a.getSelection()||e(a).lastQuery;c(a,h,"Replace:",d,function(d){d&&(d=j(d),c(a,t,"Replace with:","",function(c){if(f)a.operation(function(){for(var f,
e=b(a,d);e.findNext();)"string"!=typeof d?(f=a.getRange(e.from(),e.to()).match(d),e.replace(c.replace(/\$(\d)/g,function(b,a){return f[a]}))):e.replace(c)});else{o(a);var e=b(a,d,a.getCursor()),h=function(){var f=e.from(),c;((c=e.findNext())||(e=b(a,d),(c=e.findNext())&&(!f||e.from().line!=f.line||e.from().ch!=f.ch)))&&(a.setSelection(e.from(),e.to()),a.scrollIntoView({from:e.from(),to:e.to()}),i(a,p,"Replace?",[function(){j(c)},h]))},j=function(b){e.replace("string"==typeof d?c:c.replace(/\$(\d)/g,
function(a,f){return b[f]}));h()};h()}}))})}}var l='Search: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',h='Replace: <input type="text" style="width: 10em" class="CodeMirror-search-field"/> <span style="color: #888" class="CodeMirror-search-hint">(Use /re/ syntax for regexp search)</span>',t='With: <input type="text" style="width: 10em" class="CodeMirror-search-field"/>',
p="Replace? <button>Yes</button> <button>No</button> <button>Stop</button>";a.commands.find=function(b){o(b);n(b)};a.commands.findPersistent=function(b){o(b);n(b,!1,!0)};a.commands.findNext=n;a.commands.findPrev=function(b){n(b,!0)};a.commands.clearSearch=o;a.commands.replace=s;a.commands.replaceAll=function(b){s(b,!0)}});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function m(a,b,d,c){var i,j,k,n;this.atOccurrence=!1;this.doc=a;null==c&&"string"==typeof b&&(c=!1);d=d?a.clipPos(d):e(0,0);this.pos={from:d,to:d};"string"!=typeof b?(b.global||(b=RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(d,c){var j,l,h,i,k;if(d){b.lastIndex=0;j=a.getLine(c.line).slice(0,
c.ch);for(l=0;!(b.lastIndex=l,k=b.exec(j),!k)&&!(h=k,i=h.index,l=h.index+(h[0].length||1),l==j.length););(l=h&&h[0].length||0)||(0==i&&0==j.length?h=void 0:i!=a.getLine(c.line).length&&l++)}else b.lastIndex=c.ch,j=a.getLine(c.line),l=(h=b.exec(j))&&h[0].length||0,i=h&&h.index,i+l==j.length||l||(l=1);if(h&&l)return{from:e(c.line,i),to:e(c.line,i+l),match:h}}):(i=b,c&&(b=b.toLowerCase()),j=c?function(a){return a.toLowerCase()}:function(a){return a},k=b.split("\n"),1==k.length?this.matches=b.length?
function(d,c){if(d){var k=a.getLine(c.line).slice(0,c.ch),l=j(k),h=l.lastIndexOf(b);if(-1<h)return h=q(k,l,h),{from:e(c.line,h),to:e(c.line,h+i.length)}}else if(k=a.getLine(c.line).slice(c.ch),l=j(k),h=l.indexOf(b),-1<h)return h=q(k,l,h)+c.ch,{from:e(c.line,h),to:e(c.line,h+i.length)}}:function(){}:(n=i.split("\n"),this.matches=function(b,c){var d=k.length-1,i,h,m,p,g;if(b){if(c.line-(k.length-1)<a.firstLine()||j(a.getLine(c.line).slice(0,n[d].length))!=k[k.length-1])return;i=e(c.line,n[d].length);
p=c.line-1;for(g=d-1;1<=g;--g,--p)if(k[g]!=j(a.getLine(p)))return;return(h=a.getLine(p),m=h.length-n[0].length,j(h.slice(m))!=k[0])?void 0:{from:e(p,m),to:i}}if(!(c.line+(k.length-1)>a.lastLine())&&(h=a.getLine(c.line),m=h.length-n[0].length,j(h.slice(m))==k[0])){i=e(c.line,m);p=c.line+1;for(g=1;g<d;++g,++p)if(k[g]!=j(a.getLine(p)))return;if(j(a.getLine(p).slice(0,n[d].length))==k[d])return{from:i,to:e(p,n[d].length)}}}))}function q(a,b,d){var c;if(a.length==b.length)return d;for(b=Math.min(d,a.length);;)if(c=
a.slice(0,b).toLowerCase().length,c<d)++b;else if(c>d)--b;else return b}var e=a.Pos;m.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){a=e(a,0);return d.pos={from:a,to:a},d.atOccurrence=!1,!1}for(var d=this,c=this.doc.clipPos(a?this.pos.from:this.pos.to),i;;){if(this.pos=this.matches(a,c))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!c.line)return b(0);c=e(c.line-1,this.doc.getLine(c.line-1).length)}else{if(i=
this.doc.lineCount(),c.line==i-1)return b(i);c=e(c.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(f,b){if(this.atOccurrence){var d=a.splitLines(f);this.doc.replaceRange(d,this.pos.from,this.pos.to,b);this.pos.to=e(this.pos.from.line+d.length-1,d[d.length-1].length+(1==d.length?this.pos.from.ch:0))}}};a.defineExtension("getSearchCursor",function(a,b,d){return new m(this.doc,a,b,d)});a.defineDocExtension("getSearchCursor",
function(a,b,d){return new m(this,a,b,d)});a.defineExtension("selectMatches",function(e,b){for(var d=[],c=this.getSearchCursor(e,this.getCursor("from"),b);c.findNext()&&!(0<a.cmpPos(c.to(),this.getCursor("to")));)d.push({anchor:c.from(),head:c.to()});d.length&&this.setSelections(d,0)})});
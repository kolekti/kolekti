(function(b){"object"==typeof exports&&"object"==typeof module?b(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],b):b(CodeMirror)})(function(b){function l(a){a.operation(function(){p(a)})}function m(a){a.state.markedSelection.length&&a.operation(function(){h(a)})}function e(a,c,d,n){if(0!=i(c,d))for(var f=a.state.markedSelection,g=a.state.markedSelectionStyle,b=c.line;;){var e=b==c.line?c:o(b,0),b=b+k,h=b>=d.line,j=h?d:o(b,0),e=a.markText(e,j,
{className:g});null==n?f.push(e):f.splice(n++,0,e);if(h)break}}function h(a){for(var a=a.state.markedSelection,c=0;c<a.length;++c)a[c].clear();a.length=0}function j(a){h(a);for(var c=a.listSelections(),d=0;d<c.length;d++)e(a,c[d].from(),c[d].to())}function p(a){if(!a.somethingSelected())return h(a);if(1<a.listSelections().length)return j(a);var c=a.getCursor("start"),d=a.getCursor("end"),b=a.state.markedSelection;if(!b.length)return e(a,c,d);var f=b[0].find(),g=b[b.length-1].find();if(!f||!g||d.line-
c.line<k||0<=i(c,g.to)||0>=i(d,f.from))return j(a);for(;0<i(c,f.from);)b.shift().clear(),f=b[0].find();0>i(c,f.from)&&(f.to.line-c.line<k?(b.shift().clear(),e(a,c,f.to,0)):e(a,c,f.from,0));for(;0>i(d,g.to);)b.pop().clear(),g=b[b.length-1].find();0<i(d,g.to)&&(d.line-g.from.line<k?(b.pop().clear(),e(a,g.from,d)):e(a,g.to,d))}b.defineOption("styleSelectedText",!1,function(a,c,d){d=d&&d!=b.Init;if(c&&!d){a.state.markedSelection=[];a.state.markedSelectionStyle=typeof c=="string"?c:"CodeMirror-selectedtext";
j(a);a.on("cursorActivity",l);a.on("change",m)}else if(!c&&d){a.off("cursorActivity",l);a.off("change",m);h(a);a.state.markedSelection=a.state.markedSelectionStyle=null}});var k=8,o=b.Pos,i=b.cmpPos});
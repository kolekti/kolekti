(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function t(c){c=c.search(n);return-1==c?0:c}var x={},n=/[^\s\u00a0]/,j=h.Pos;h.commands.toggleComment=function(c){for(var e=Infinity,a=c.listSelections(),d=null,b=a.length-1;0<=b;b--){var f=a[b].from(),g=a[b].to();f.line>=e||(g.line>=e&&(g=j(e,0)),e=f.line,null==d?c.uncomment(f,g)?d="un":(c.lineComment(f,
g),d="line"):"un"==d?c.uncomment(f,g):c.lineComment(f,g))}};h.defineExtension("lineComment",function(c,e,a){a||(a=x);var d=this,b=d.getModeAt(c),f=a.lineComment||b.lineComment;if(f){var g=d.getLine(c.line);if(null!=g){var k=Math.min(0!=e.ch||e.line==c.line?e.line+1:e.line,d.lastLine()+1),h=null==a.padding?" ":a.padding,i=a.commentBlankLines||c.line==e.line;d.operation(function(){if(a.indent)for(var e=g.slice(0,t(g)),b=c.line;b<k;++b){var o=d.getLine(b),m=e.length;if(i||n.test(o))o.slice(0,m)!=e&&
(m=t(o)),d.replaceRange(e+f+h,j(b,0),j(b,m))}else for(b=c.line;b<k;++b)(i||n.test(d.getLine(b)))&&d.replaceRange(f+h,j(b,0))})}}else if(a.blockCommentStart||b.blockCommentStart)a.fullLines=!0,d.blockComment(c,e,a)});h.defineExtension("blockComment",function(c,e,a){a||(a=x);var d=this,b=d.getModeAt(c),f=a.blockCommentStart||b.blockCommentStart,g=a.blockCommentEnd||b.blockCommentEnd;if(!f||!g)(a.lineComment||b.lineComment)&&!1!=a.fullLines&&d.lineComment(c,e,a);else{var k=Math.min(e.line,d.lastLine());
k!=c.line&&(0==e.ch&&n.test(d.getLine(k)))&&--k;var h=null==a.padding?" ":a.padding;c.line>k||d.operation(function(){if(!1!=a.fullLines){var i=n.test(d.getLine(k));d.replaceRange(h+g,j(k));d.replaceRange(f+h,j(c.line,0));var u=a.blockCommentLead||b.blockCommentLead;if(null!=u)for(var l=c.line+1;l<=k;++l)(l!=k||i)&&d.replaceRange(u+h,j(l,0))}else d.replaceRange(g,e),d.replaceRange(f,c)})}});h.defineExtension("uncomment",function(c,e,a){a||(a=x);var d=this,b=d.getModeAt(c),f=Math.min(0!=e.ch||e.line==
c.line?e.line:e.line-1,d.lastLine()),g=Math.min(c.line,f),h=a.lineComment||b.lineComment,t=[],i=null==a.padding?" ":a.padding,u;a:if(h){for(var l=g;l<=f;++l){var o=d.getLine(l),m=o.indexOf(h);-1<m&&!/comment/.test(d.getTokenTypeAt(j(l,m+1)))&&(m=-1);if(-1==m&&(l!=f||l==g)&&n.test(o))break a;if(-1<m&&n.test(o.slice(0,m)))break a;t.push(o)}d.operation(function(){for(var a=g;a<=f;++a){var c=t[a-g],b=c.indexOf(h),e=b+h.length;0>b||(c.slice(e,e+i.length)==i&&(e+=i.length),u=!0,d.replaceRange("",j(a,b),
j(a,e)))}});if(u)return!0}var r=a.blockCommentStart||b.blockCommentStart,q=a.blockCommentEnd||b.blockCommentEnd;if(!r||!q)return!1;var y=a.blockCommentLead||b.blockCommentLead,v=d.getLine(g),s=f==g?v:d.getLine(f),w=v.indexOf(r),p=s.lastIndexOf(q);-1==p&&g!=f&&(s=d.getLine(--f),p=s.lastIndexOf(q));if(-1==w||-1==p||!/comment/.test(d.getTokenTypeAt(j(g,w+1)))||!/comment/.test(d.getTokenTypeAt(j(f,p+1))))return!1;b=v.lastIndexOf(r,c.ch);a=-1==b?-1:v.slice(0,c.ch).indexOf(q,b+r.length);if(-1!=b&&-1!=a&&
a+q.length!=c.ch)return!1;a=s.indexOf(q,e.ch);c=s.slice(e.ch).lastIndexOf(r,a-e.ch);b=-1==a||-1==c?-1:e.ch+c;if(-1!=a&&-1!=b&&b!=e.ch)return!1;d.operation(function(){d.replaceRange("",j(f,p-(i&&s.slice(p-i.length,p)==i?i.length:0)),j(f,p+q.length));var a=w+r.length;i&&v.slice(a,a+i.length)==i&&(a=a+i.length);d.replaceRange("",j(g,w),j(g,a));if(y)for(a=g+1;a<=f;++a){var c=d.getLine(a),b=c.indexOf(y);if(!(b==-1||n.test(c.slice(0,b)))){var e=b+y.length;i&&c.slice(e,e+i.length)==i&&(e=e+i.length);d.replaceRange("",
j(a,b),j(a,e))}}});return!0})});
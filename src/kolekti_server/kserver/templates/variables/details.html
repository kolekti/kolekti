{% extends "base-wide.html" %}

{% block current_tools %}menu-current{% endblock %}
{% block help-topic %}variable{% endblock %}

{% block extracss %}
    <link rel="stylesheet" type="text/css"  href="/static/css/kolekti-variables.css"></script>
{% endblock %}

{% block extrascripts %}
<script src="/static/js/kolekti-variables.js" type="text/javascript"></script>
<script>
  var kolekti_variable_data = {{ vardata|safe }};;
  var kolekti_variable_path = "{{ path }}";
</script>
{% endblock %}

{% block title %}Variables : <span title="{{ path }}"> {{ name }}</span>{% endblock %}

{% block content %}

<div id="main" 		data-path = "{{ path }}">
    <div class="row">
      <div class="col-sm-12 col-md-6">
	<h3>Liste des variables</h3>
	<p class="info">Cliquez sur le nom d'une variable pour éditer les valeurs</p>
	<ul class="list-group">
	  {% for variable in variables %}
	  <li class="list-group-item">
	    <a href="{% url 'variableeditval' %}?path={{ path }}&index={{ forloop.counter }}">{{variable}}</a>
	    <span class="pull-right">
	      <button class="btn btn-xs btn-default kolekti-action-rename-variable" title="Renommer">
		<i class="fa fa-pencil"></i>
	      </button>
	      <button data-varname="{{variable}}" data-varindex="{{forloop.counter}}" class="btn btn-xs btn-default kolekti-action-remove-variable" title="Supprimer">
		<i class="fa fa-trash"></i>
	      </button>
	    </span>
	  </li>
	  {% endfor %}
	  <li class="list-group-item">
	    <form method="POST">
	      <input type="hidden" name="action" value="newvar"/>
	      <input type="hidden" name="path" value="{{path}}"/>
	      <input type="text" id="var_newvar" name="varname" placeholder="nouvelle variable"/>
	      <span class="pull-right">
		<button class="btn btn-warning btn-sm">Ajouter une variable</button>
	      </span>
	    </form>
	  </li>
	</ul>
      </div>
      <div class="col-sm-12 col-md-6">
	<h3>Liste des conditions</h3>
	<p class="info">Cliquez sur une condition pour éditer les valeurs des toutes les variables</p>
	<ul class="list-group">
	  {% for condition in conditions %}
	  <li class="list-group-item">
	    <a href="{% url 'variableeditcol' %}?path={{ path }}&index={{ forloop.counter }}">{{ condition.label }}</a>
	    <span class="pull-right">
	      <button class="btn btn-xs btn-default kolekti-action-edit-condition" title="Modifier la condition">
		<i class="fa fa-pencil"></i>
	      </button>
	      <button class="btn btn-xs btn-default kolekti-action-remove-condition" title="Supprimer">
		<i class="fa fa-trash"></i>
	      </button>
	    </span>
	  </li>
	  {% endfor %}
	  <li class="list-group-item">
	    <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal_cond">
	      Ajouter une condition...
	    </button>
	    <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#modal_add_crit">
	      Ajouter un critère...
	    </button>	   
	  </li>
	</ul>
      </div>
      
      <!--      <div class="col-sm-12 col-md-3">-->

      // Add condition dialog
      
      <div class="modal fade" id="modal_cond" tabindex="-1" role="dialog" aria-labelledby="label_cond">
	<div class="modal-dialog" role="document">
	  <div class="modal-content">
	    <div class="modal-header">
	      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	      <h4 class="modal-title" id="label_cond">Condition</h4>
	    </div>
	    <form class="form form-horizontal" method="POST">
	      <input type="hidden" name="action" value="newcond"/>
	      <input type="hidden" name="path" value="{{path}}"/>
	      
	      <div class="modal-body">
		{% for crit in crits %}
		<div class="form-group">
		  
		  <label for="id_{{forloop.counter}}" class="col-sm-4 control-label">{{crit}}</label>
		  <div class="col-sm-8">
		    <div class="btn-group">
		      <button type="button" class="btn btn-default pull-right dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
id = "id_{{forloop.counter}}"
			      >
			<span class="valuelabel">Valeur</span> <span class="caret"></span>
		      </button>

		      <ul class="dropdown-menu">
			{% for name,values in criteria.items %}
			
			{% if name == crit %}
			{% for value in values %}
			<li><a class="cond_item" data-valuelabel="{{ value }}" href="#">{{ value }}</a></li>
			{% endfor %}
			{% endif %}
			{% endfor %}
		      </ul>
		    </div>
		  </div>
		</div>
		{% endfor %}
	      </div>
	      
	      
	    <div class="modal-footer">
	      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
	      <button type="submit" class="btn btn-warning">Enregistrer</button>
	    </div>
	    <!--
		<p class="pull-right">
		  <button class="btn btn-primary">Ajouter</button>
		</p>
		-->
	  </form>
	  </div>
	</div>
      </div>
    </div>
    <!--	</div> -->
    <!-- <div class="col-sm-12 col-md-3"> -->

    // Add criteria modal
    
    <div class="modal fade" id="modal_add_crit" tabindex="-1" role="dialog" aria-labelledby="label_add_crit">
      <div class="modal-dialog" role="document">
	<div class="modal-content">
	  <div class="modal-header">
	    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	    <h4 class="modal-title" id="label_add_crit">Ajouter un critère</h4>
	  </div>
	  <form method="POST" class="form-horizontal">
	    <input type="hidden" name="action" value="newcrit"/>
	    <input type="hidden" name="path" value="{{path}}"/>
	    
	    <div class="modal-body">
	      <div class="form-group">
		<label for="mbtn_add_crit_cond" class="col-sm-4 control-label">Critère</label>
		<div class="col-sm-8">
		  <div class="btn-group">
		    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="mbtn_add_crit_cond">
		      <span class="valuelabel"><em>Selectionnez un critère</em></span> <span class="caret"></span>
		    </button>
		    <ul class="dropdown-menu">
		      {% for name,values in criteria.items %}
		      {% if name in crits %}{% else %}
		      <li><a href="#" class="crit_cond_item" data-valuelabel="{{ name }}">{{ name }}</a></li>
		      {% endif %}
		      {% endfor %}
		    </ul>
		  </div>
		</div>
	      </div>
	      
	      <div class="form-group">
		<label for="mbtn_add_crit_val" class="col-sm-4 control-label">Valeur initiale</label>
		<div class="col-sm-8">
		  <div class="btn-group">
		    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
		      -- <span class="caret"></span>
		    </button>
		    <ul class="dropdown-menu">
		      <li><a href="#"><em>Selectionnez un critère</em></a></li>
		    </ul>
		  </div>
		</div>
	      </div>
	      
	    </div>
	    <div class="modal-footer">
	      <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
	      <button type="submit" class="btn btn-warning">Enregistrer</button>
	    </div>
	  </form>
	</div>
      </div>
    </div>
</div>

    
{% endblock %}

{% comment %}
{% block menu %}
    <div class="row">
      <div class="col-sm-12 col-md-12">
	<button type="button" class="btn btn-block btn-default disabled" id="btn_save"
		data-path = "{{ path }}">
	  Enregistrer
	</button>
      </div>
    </div>
{% endblock %}
{% endcomment %} 
    
